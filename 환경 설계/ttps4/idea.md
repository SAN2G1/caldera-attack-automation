## 1. 먼저, “현실적으로” 어디까지 구현할 건지 선 긋기

보고서에는:

* 정찰
* 자원 개발
* 최초 침투
* 실행
* 지속성
* 자격 증명 탈취
* 방어 회피
* 측면 이동
* 내부 정보 수집
* 유출


### 현실적인 목표선

1. **핵심 포커스:**

   * 피싱 타깃 정찰
   * 피싱/공격 자원 개발

2. **최소한의 확장:**

   * “피싱 메일을 보냈고 누군가 눌러서 에이전트가 하나 떠 있다” 정도까지는 모의로 표현
   * 내부 측면 이동, 키로깅, 대규모 유출은 과감히 생략 또는 1–2 스텝으로 축약

3. **Caldera 관점:**

   * Recon/Resource 부분은 사실 “공격자 측에서 돌아가는 스크립트” 느낌
   * Initial access 이후는 “피해자 PC에 agent가 이미 떠있다고 가정하고 한두 스텝만”

---

## 2. 전체를 4개의 큰 단계로 “재구성”하기

복잡한 9~10단계 대신, **논리 구조는 유지하면서 구현 가능한 4단계**로 줄여보자.

1. 정찰(피싱 타깃/계정/정책 조사)
2. 자원 개발(피싱 인프라/URL/템플릿/메일 내용 준비)
3. 최초 침투(피싱 메일 발송 + 클릭 결과로 에이전트 생성 “가정”)
4. 간단한 실행/수집/유출(한두 개 커맨드로만 표현, 깊은 APT X)

아래에서 단계별로 “논리 + 실제 구현 아이디어” 같이 적을게.

---

## 3. 단순화된 단계별 시나리오 설계

### 3-1. 1단계: 피싱 타깃 정찰 (Reconnaissance)

**논리(보고서와의 연결)**

* 검색엔진·SNS·조직 홈페이지를 통해

  * 공격 대상이 될 만한 인물/부서
  * 이메일 패턴(예: [name@company.com](mailto:name@company.com))
  * 로그인/패스워드 재설정 페이지
  * MFA 여부
    를 파악한다는 내용이 있었지.

**우리가 구현할 최소 버전**

1. 조직 도메인에 HTTP GET (조직 대표 페이지)
2. “/contact”, “/staff”, “/team” 같은 경로에 GET 보내 보기
3. 응답 HTML에서

   * 이메일 정규식으로 candidate 계정 목록 추출
   * 로그인/비밀번호 재설정 페이지 URL 추출
4. 비밀번호 재설정 URL에 더미 이메일로 POST를 한 번 보내서

   * 응답 메시지로 MFA/계정 존재 여부를 유추하는 로직(“user not found”, “OTP sent” 같은 문자열 검사)

**Caldera에서 구현하기 쉽게 생각하면**

* 능동 정찰용 ability 2~3개:

  * `Invoke-WebRequest` 또는 `curl`로 페이지 가져오기
  * PowerShell/파이썬으로 regex로 이메일 패턴 추출해서 fact로 저장
  * reset_password endpoint에 POST 보내고 응답 문자열만 로그에 남김
-> 능동이 아니라 환경 정보에 적어서 정확한 정찰을 하게 하도록하고싶어
→ 이 단계만으로도 “피싱 대상 리스트 + MFA 환경 정보”가 정리됐다고 볼 수 있음.

---

### 3-2. 2단계: 공격 자원 개발 (Resource Development)

**논리(보고서와의 연결)**

* 영세 서버·도메인을 확보하거나
* 피싱 페이지를 만들고
* Base64로 계정 정보를 파라미터에 넣어서 개별 추적
* 피싱 메일 자동 생성/발송 파이프라인 구축
  이 부분이 전부 여기.

**우리가 구현할 최소 버전**

여기서는 실제 도메인 구매, 실제 서버 구축 같은 건 안 하고, **“문자열 조작·파일 생성 수준”으로만 표현**하자.

1. **피싱 URL 생성 로직**

   * 정찰 단계에서 얻은 victim_email 하나를 선택
   * Base64 인코딩 수행
   * `http://phish.example.com/login?u=<base64>` 형태의 문자열 생성
   * 이걸 fact/파일로 저장

2. **피싱 로그인 페이지 템플릿 생성**

   * 정찰 때 가져온 로그인 페이지 응답에서

     * `<title>`이나 로고 텍스트 몇 개만 추출했다고 가정
   * 그걸 이용해서 로컬에 `phish_login.html` 같은 템플릿 파일 생성

     * 완전한 HTML 아니어도 됨, “회사 로고/문구 일부 + 폼 + submit 버튼 + 위에서 만든 URL” 정도

3. **피싱 메일 본문/제목 자동 구성**

   * 조직 이름, 담당자 이름(가짜), 피싱 URL을 가지고 문자열 포매팅
   * 예: `[회사명] 보안 업데이트 안내`
   * 본문에 `피싱 URL` 삽입
   * 결과를 텍스트 파일(`phish_mail.txt`)로 저장

**Caldera 관점**

* 여기서 돌아가는 건 전부 “공격자 측 스크립트”라고 보면 되니까,
  한 에이전트(공격자 머신 역할)에서 돌아가는 PowerShell/파이썬 ability로 구현 가능:

  * Base64 인코딩
  * 문자열 조립
  * 파일로 쓰기

→ 이 단계가 끝나면, **“피싱 URL + 피싱 페이지 템플릿 + 피싱 메일 컨텐츠”가 준비된 상태**가 됨.
보고서 표현대로 말하면 “공격 자원 개발 완료”.

---

### 3-3. 3단계: 최초 침투 (Initial Access – 완전 모의/축약)

**논리(보고서와의 연결)**

* 스피어피싱 이메일로

  * 악성코드 첨부
  * 악성 링크 포함
* 사전에 탈취했던 계정까지 활용하는 내용이 있었지.

**우리가 구현하는 방식(최대한 단순화)**

실제로 메일을 보내고 사용자가 클릭하는 걸 환경에서 구현하려면
메일 서버, 클라이언트, 클릭 이벤트, 브라우저 등 너무 세팅할 게 많음.

그래서 연구 프로토타입에서는 **“클릭 결과만 시뮬레이션”**하는 방식으로 두자:

1. 공격자 측에서 “피싱 메일 발송”을 **로그/파일로만 기록**

   * 예: `sent_phish_to_victim@example.com_at_2025-12-09.log`
2. “피해자가 링크를 클릭했다”고 가정하고

   * Caldera에서 **새 victim agent 하나를 수동/자동 등록**하는 스텝으로 연결
   * 이 agent가 곧 “피해자 PC” 역할을 하게 됨

**Caldera 관점**

* 프로토타입에서는:

  * Initial Access를 “새 agent가 등장하는 이벤트”로만 모델링
  * 실제 메일 발송/클릭은 Self-Correcting/시뮬레이션 설명에서 텍스트로 처리

→ 이 단계는 **논리 흐름 유지용**이고, 구현 난이도는 “파일 하나 만들기 + agent 하나 띄우기” 수준으로 둔다.

---

### 3-4. 4단계: 간단한 실행·정보 수집·유출 (Execution + Collection + Exfiltration 축약)

정찰 & 자원 개발이 메인이라서, 뒤 단계는 **“너무 얕게 한 번만 보여주는 데모 용도”**로만 두는 게 좋음.

**논리(보고서와의 연결)**

* 원격제어 악성코드 실행
* 키로깅/화면 캡쳐/파일 수집
* 일정 크기 이상이면 분할 유출 등

**우리가 구현하는 최소 버전**

피해자 agent에서:

1. **간단한 실행**

   * 예: `whoami`, `hostname` 정도만 실행해서 “명령 실행 성공”을 보여줌

2. **내부 정보 수집**

   * 특정 디렉토리(예: `C:\Users\Victim\Documents\important`) 목록을 수집
   * 결과를 텍스트 파일로 저장

3. **데이터 압축 + 업로드(유출)**

   * 위 디렉토리(또는 작은 샘플 파일) zip으로 압축
   * Caldera `uploads` 필드로 서버에 업로드

여기서 키로깅, 측면이동, AV 회피 같은 건 **싹 다 빼고**,
“최소한 공격이 성공해서 뭔가 하나 가져갈 수 있다” 정도로만 표현.

---

## 4. 최종 단순화 시나리오 한 줄 요약

> 공격자는 먼저 검색엔진과 조직 웹사이트를 통해
> 피싱에 사용할 이메일 계정과 로그인·재설정 페이지 정보를 수집한다.
> 수집한 계정과 정책 정보를 바탕으로 Base64가 포함된 피싱 URL, 로그인 페이지 템플릿, 그리고
> 자동 생성된 피싱 메일 본문을 준비하고, 이 자원들을 활용해 스피어피싱 메일을 보낸다.
> 피해자가 링크를 클릭해 악성 페이지에 접속했다고 가정하면,
> 공격자는 해당 PC에 에이전트를 설치해 간단한 시스템 정보와 일부 문서 목록을 수집하고,
> 이를 압축해 공격자 서버(C2)로 전송한다.

---

## 5. 보고서 개요 단계와 매핑해 보면

너가 준 개요 단계랑 비교하면 이렇게 축약되는 거야:

* 정찰 → **1단계: 타깃 정찰 (웹/SNS/계정/MFA 파악)**
* 자원 개발 → **2단계: 피싱 URL·템플릿·메일 콘텐츠 자동 생성**
* 최초 침투 → **3단계: 피싱 메일 발송 + 클릭을 에이전트 등장으로 모의**
* 실행 + 내부 정보 수집 + 유출 → **4단계: 간단한 명령 + 특정 폴더 목록 + ZIP 업로드**

지속성, 자격 증명 확보, 방어 회피, 측면 이동은
**이번 “피싱 타깃 정찰 & 자원 분석” 시나리오에서는 의도적으로 생략**하거나
추후 확장 버전에서 다루는 게 맞고.

---

이제 이 구조를 기준으로:

* abstract_flow(step2)용 “simple_attack_flow” 버전,
* 그리고 나중에 여기에 맞춘 environment_description(공격자/피해자 역할만 단순 정의)
  둘 다 만들기 훨씬 쉬워질 거야.

다음 단계로는
**① 이 4단계를 step2.yml 스타일 YAML로 써줄까, 아니면
② 각 단계에 대응하는 Caldera ability 설계(이름/설명/대략 명령어)를 먼저 뽑아볼까?**
