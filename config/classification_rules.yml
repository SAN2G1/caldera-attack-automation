# M7 Self-Correcting - Failure Classification Rules
# 실패 유형별 키워드 및 패턴 정의

syntax_error:
  description: "명령어 문법 오류"
  keywords:
    - "syntax error"
    - "unexpected token"
    - "parse error"
    - "ParserError"
    - "TerminatorError"
    - "UnexpectedToken"
    - "InvalidOperationException"
    - "cannot parse"

  patterns:
    - "line \\d+:"
    - "At line:\\d+"
    - "position \\d+"
    - "char:\\d+"

missing_env:
  description: "환경 정보 누락 (IP, URL, 경로 등)"
  keywords:
    - "cannot find path"
    - "invalid URI"
    - "connection refused"
    - "host not found"
    - "no such file"
    - "not found"
    - "does not exist"
    - "target machine actively refused"
    - "unable to connect"
    - "network path was not found"

  extractors:
    ip_address: "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}"
    file_path: "[A-Z]:\\\\[\\w\\\\.\\s-]+"
    url: "https?://[\\w\\.\\-:]+"
    placeholder: "[A-Z_]+_[A-Z_]+"  # TARGET_IP, WEB_URL 등

caldera_constraint:
  description: "Caldera 제약사항 (변수 공유 불가 등)"
  keywords:
    - "variable is not defined"
    - "undefined variable"
    - "cannot find variable"
    - "variable '$"
    - "The term '$"
    - "not recognized as the name"

  patterns:
    - "\\$\\w+"  # PowerShell 변수
    - "#{\\w+}"  # Caldera 변수

dependency_error:
  description: "권한 부족 또는 선행 조건 미충족"
  keywords:
    - "access denied"
    - "access is denied"
    - "requires elevation"
    - "privilege"
    - "unauthorized"
    - "permission denied"
    - "not authorized"
    - "run as administrator"
    - "SeDebugPrivilege"

  patterns:
    - "error code: 5"  # Access Denied
    - "0x[0-9A-Fa-f]+"  # Windows 에러 코드

unrecoverable:
  description: "복구 불가능한 오류"
  keywords:
    - "not recognized as cmdlet"
    - "not recognized as the name"
    - "command not found"
    - "is not installed"
    - "module could not be loaded"
    - "cannot load assembly"
    - "fatal error"
    - "critical error"

  patterns:
    - "0xC0000005"  # Access Violation
    - "segmentation fault"
