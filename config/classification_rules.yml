# Self-Correcting - Failure Classification Rules
# Priority order: syntax_error > timeout > dependency_error > missing_env > unrecoverable
# All patterns are case-insensitive regex

syntax_error:
  description: |
    SYNTAX ERROR - Command Syntax Error
    The command syntax is invalid and cannot be parsed or executed.
    This includes incorrect parameter formats, missing arguments,
    incompatible command usage, and string/path format errors.
  patterns:
    # PowerShell parser errors
    - "parsererror"
    - "unexpected token"
    - "At line:\\d+"
    - "is not a valid statement separator"
    # Parameter errors
    - "invalid\\s+(key\\s+name|parameter)"
    - "positional parameter"
    - "cannot be found that accepts"
    # Format errors
    - "second path fragment must not be"
    - "cannot be more than"
    - "incorrectly formatted"
    - "cannot overwrite the item.+with itself"
    # CMD/PowerShell compatibility
    - "is not recognized as the name of a cmdlet"
    # bcdedit/system command errors
    - "command specified is not valid"
    - "service name is invalid"

timeout:
  description: |
    TIMEOUT - Execution Time Exceeded
    The command execution did not complete within the specified time limit.
    This includes long-running operations, timeout while waiting for response,
    and service response delays.
  patterns:
    - "timeout\\s*reached"
    - "process\\s*(was\\s*)?killed"
    - "did not respond.+in a timely fashion"
  exit_codes:
    - 124

dependency_error:
  description: |
    DEPENDENCY ERROR - Dependency/Permission Issues
    The prerequisites required for command execution are not met.
    This includes insufficient permissions, cascading failures due to prior task failures,
    authentication failures, remote connection configuration issues, and service access denials.
  patterns:
    # Permission related
    - "access\\s*(is\\s*)?denied"
    - "requires?\\s+elevation"
    - "privilege"
    - "unauthori[sz]ed"
    - "run\\s+as\\s+administrator"
    - "user credentials cannot be used for local"
    - "user credentials are not allowed"
    - "account restrictions"
    - "accessviolationexception"
    # Service related
    - "(open|start|create)service\\s+failed"
    - "service does not exist"
    - "service cannot be started"
    - "initialization failure"
    # WinRM/Remote related
    - "winrm\\s+client\\s+cannot\\s+process"
    - "connecting to remote server.+failed"
    - "psremoting"
    - "trustedhosts"

missing_env:
  description: |
    MISSING ENVIRONMENT - Environment/Resource Absence
    The file, path, network resource, or service referenced by the command does not exist
    in the current environment. This includes incorrect IP/URL, non-existent file paths,
    and network connection failures.
  patterns:
    # Path/file not found
    - "cannot find (path|drive)"
    - "could not find (a part of )?the path"
    - "does not exist"
    - "cannot find type"
    - "no file received"
    - "network name cannot be found"
    # Network related
    - "unable to connect"
    - "network\\s+connection\\s+could\\s+not\\s+be\\s+found"
    # Windows system errors
    - "system error\\s+(53|67|86|1355|6118)"

unrecoverable:
  description: |
    UNRECOVERABLE - Cannot be Fixed
    Does not fall into the above categories, or there is insufficient error information
    to determine the cause. This includes cases with no output and other errors
    that do not match classification criteria.
  patterns: []
