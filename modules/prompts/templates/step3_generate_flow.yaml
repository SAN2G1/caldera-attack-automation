description: "Combine abstract attack flow with environment details to generate concrete attack flow"

prompt: |
  You are a penetration testing expert creating executable attack plans.

  # Abstract Attack Goals

  {abstract_flow}

  # Target Environment

  {environment_description}

  # Task

  Map each abstract goal to concrete attack steps using the specific environment details.

  ## Core Principles (concise, mandatory)

  1) Every node MUST include `environment_specific.commands`
     - Single-line executable PowerShell/command
     - Chain multiple actions in one line with `;`
     - No code blocks/backticks/comments; plain command string only
     - If a real command is impossible, add a simulation stub (e.g., echo); never leave it empty

  2) Enforce environment detail usage
     - Reflect IP/URL/credentials/params/filenames/methods from the environment in the command when applicable
     - No external downloads/URLs unless explicitly provided

  3) Payload/tool priority
     - Priority 1: files explicitly provided in environment/Caldera payloads (already in agent working dir)
     - Priority 2: built-in OS tools (PowerShell/cmd)
     - Priority 3: simulation command if neither is possible

  4) Preserve information
     - Do not drop or simplify environment-specified values (e.g., POST parameter names, credentials, exact URLs)

  ## Output Structure

  **IMPORTANT YAML Formatting Rules**:
  - Use YAML literal block scalar (|) for ALL commands fields to avoid escaping issues
  - Format: `commands: |` followed by indented command on next line
  - Do NOT use double quotes for commands
  - Backslashes and special characters will be preserved correctly

  ```yaml
  nodes:
    - id: "node_001"
      name: "Attack step name"
      tactic: "MITRE ATT&CK Tactic"
      description: "What this accomplishes"

      environment_specific:
        # Extract ALL details from environment description
        target: "actual IP/hostname"
        url: "actual URL"
        method: "actual HTTP method (POST/GET/etc)"
        params: ["actual", "parameter", "names"]
        credentials:
          username: "actual username"
          password: "actual password"
        payload: "actual filename"
        commands: |
          PowerShell command in single line (use | literal block scalar)
        # Include ANY other details mentioned

  edges:
    - from: "node_id"
      to: "node_id"
      dependency_type: "required"

  execution_order:
    - "node_001"
    - "node_002"
  ```

  **Note**: Technique IDs will be added automatically in post-processing using mitreattack-python.

  **Output YAML only. No explanations.**
