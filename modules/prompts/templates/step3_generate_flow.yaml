description: "Combine abstract attack flow with environment details to generate concrete attack flow - AI generates MITRE techniques from internal knowledge"

prompt: |
  You are a penetration testing expert with deep knowledge of MITRE ATT&CK framework.

  # Abstract Attack Goals

  {abstract_flow}

  # Target Environment

  {environment_description}

  # Task

  Map each abstract goal to concrete attack steps using the specific environment details.
  For each step, select the most appropriate MITRE ATT&CK technique based on your knowledge.

  ## Core Principles (concise, mandatory)

  1) Every node MUST include `environment_specific.commands`
     - Single-line command executable in the target environment's shell
     - Chain multiple actions in one line with `;`
     - No code blocks/backticks/comments; plain command string only
     - If a real command is impossible, add a simulation stub (e.g., echo); never leave it empty
     - Follow any shell-specific constraints noted in the environment description

  2) Enforce environment detail usage
     - Reflect IP/URL/credentials/params/filenames/methods from the environment in the command when applicable
     - No external downloads/URLs unless explicitly provided

  3) Tool priority
     - Priority 1: built-in OS/shell tools
     - Priority 2: simulation command if a real command is impossible

  4) Preserve information
     - Do not drop or simplify environment-specified values (e.g., POST parameter names, credentials, exact URLs)

  5) **MITRE ATT&CK Technique Selection**
     - For each node, select ONE appropriate MITRE ATT&CK technique
     - Use valid technique IDs from the Enterprise ATT&CK matrix (e.g., T1059.001, T1190, T1021.002)
     - Prefer sub-techniques (e.g., T1059.001) over parent techniques (e.g., T1059) when applicable
     - The technique MUST be appropriate for {os_type} platform
     - Use your knowledge of MITRE ATT&CK framework to select the most accurate technique

  ## Output Structure

  **IMPORTANT YAML Formatting Rules**:
  - Use YAML literal block scalar (|) for ALL commands fields to avoid escaping issues
  - Format: `commands: |` followed by indented command on next line
  - Do NOT use double quotes for commands
  - Backslashes and special characters will be preserved correctly

  ```yaml
  nodes:
    - id: "node_001"
      name: "Attack step name"
      tactic: "initial-access"  # Must be one of: initial-access, execution, persistence, privilege-escalation, defense-evasion, credential-access, discovery, lateral-movement, collection, command-and-control, exfiltration, impact
      technique:
        id: "T1190"  # Valid MITRE ATT&CK technique ID
        name: "Exploit Public-Facing Application"  # Exact technique name
      description: "What this accomplishes"

      environment_specific:
        target: "actual IP/hostname"
        url: "actual URL"
        method: "actual HTTP method (POST/GET/etc)"
        params: ["actual", "parameter", "names"]
        credentials:
          username: "actual username"
          password: "actual password"
        commands: |
          Single-line command for target shell (use | literal block scalar)
        # Include ANY other details from environment description

  edges:
    - from: "node_id"
      to: "node_id"
      dependency_type: "required"

  execution_order:
    - "node_001"
    - "node_002"
  ```

  **Output YAML only. No explanations.**
